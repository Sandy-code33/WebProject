<!DOCTYPE html>
<html>
<head>
    <title>Live Location</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3_XvV-YCs9lDzsYvGKRQ0dp0znG0QOR4"></script>
</head>
<body>
    <h2>Live Location Tracking</h2>
    <div id="map" style="height: 500px; width: 500px;"></div>

    <script>
        let map, marker;

        function initMap(lat, lng) {
            const pos = { lat: lat, lng: lng };
            map = new google.maps.Map(document.getElementById("map"), {
                center: pos,
                zoom: 16,
            });
            marker = new google.maps.Marker({
                position: pos,
                map: map,
            });
        }

        function updateLocation(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;

            fetch("/save-location/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify({
                    id: "{{ uuid }}",
                    latitude: lat,
                    longitude: lng
                })
            });

            if (!map) {
                initMap(lat, lng);
            } else {
                marker.setPosition({ lat: lat, lng: lng });
                map.setCenter({ lat: lat, lng: lng });
            }
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(updateLocation);
            } else {
                alert("Geolocation not supported.");
            }
        }

        getLocation();
    </script>
</body>
</html>
